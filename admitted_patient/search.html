<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nhận bệnh</title>
    <link href="../style/navigation_bar.css" rel="stylesheet" />
    <link href="../style/setting_active.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style2.css">
</head>

<body class="m-0 p-0 flex flex-col min-h-screen bg-gray-100">
    <!-- Thanh điều hướng -->
    <nav class="bg-blueTaskbar text-white p-3 w-full text-center">
      <ul class="flex justify-between list-none p-0 m-0">
        <li class="nav-item">
          <a href="../homepage/index.html" class="font-normal"
            ><i class="fas fa-home text-white text-lg"></i
          ></a>
        </li>
        <li class="nav-item">
          <a
            href="#" class="active relative font-bold text-white px-1.5 py-2"
            >Nhận bệnh</a
          >
        </li>
        <li class="nav-item">
          <a href="../examination_health/index.html" class="font-normal text-white px-[15px] py-2"
            >Khám bệnh</a
          >
        </li>
        <li class="nav-item">
          <a href="../payment/index.html" class="font-normal text-white px-[15px] py-2">Hoá đơn</a>
        </li>
        <li class="nav-item">
            <a
                href="#" class="font-normal text-white px-[15px] py-2"
                >Báo cáo</a
            >
            <div class="dropdown">
                <a href="../report/index1.html" class="dropdown-item">Doanh thu</a>
                <a href="../report/index2.html" class="dropdown-item">Lượng thuốc</a>
            </div>
        </li>
        <li class="nav-item">
          <a href="../patient/index.html" class="font-normal text-white px-[15px] py-2"
            >Bệnh nhân</a
          >
        </li>
        <li class="nav-item">
          <a href="../medicine/index.html" class="font-normal text-white px-[15px] py-2">Thuốc</a>
        </li>
        <li class="nav-item">
            <a href="#" class="font-normal"
              ><i class="fas fa-user text-white text-lg"></i
            ></a>
            <div class="dropdown">
              <a href="../setting/index.html" class="dropdown-item">
                Cài đặt
                <i class="fas fa-cog text-white text-lg"></i
              ></a>
              <a href="../login/index.html" class="dropdown-item">
                Đăng xuất
                <i class="fas fa-sign-out-alt text-white text-lg"></i
              ></a>
            </div>
        </li>
      </ul>
    </nav>

    <main>
        <section class="search-section">
            <h2>Tra cứu</h2>
            <div class="search-table">
                <table>
                    <thead>
                        <tr>
                            <th>Mã BN</th>
                            <th>Họ và tên</th>
                            <th>Giới tính</th>
                            <th>Dân tộc</th>
                            <th>Ngày sinh</th>
                            <th>Địa chỉ</th>
                            <th>Số điện thoại</th>
                            <th>Nghề nghiệp</th>
                        </tr>
                        <tr>
                            <td><input type="text" id="searchPatientId" placeholder="Nhập mã BN"></td>
                            <td><input type="text" id="searchFullName" placeholder="Nhập họ và tên"></td>
                            <td>
                                <select id="searchGender">
                                    <option value="">Tất cả</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                </select>
                            </td>
                            <td><input type="text" id="searchEthnicity" placeholder="Nhập dân tộc"></td>
                            <td><input type="date" id="searchDob"></td>
                            <td><input type="text" id="searchAddress" placeholder="Nhập địa chỉ"></td>
                            <td><input type="text" id="searchPhone" placeholder="Nhập số điện thoại"></td>
                            <td><input type="text" id="searchJob" placeholder="Nhập nghề nghiệp"></td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <!-- <td colspan="6"></td> -->
                        </tr>
                    </tbody>
                </table>
            </div>
            <button id="searchButton" class="btn-search">
                Tìm kiếm
                <i class="fas fa-search"></i>
            </button>
        </section>

        <section class="list-section">
            <h2>Kết quả</h2>
            <div class="list-table">
                <table>
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Mã BN</th>
                            <th>Họ và tên</th>
                            <th>Giới tính</th>
                            <th>Dân tộc</th>
                            <th>Ngày sinh</th>
                            <th>Địa chỉ</th>
                            <th>Số điện thoại</th>
                            <th>Nghề nghiệp</th>
                            <th>Ghi chú</th>
                        </tr>
                    </thead>
                    <tbody id="resultTableBody">
                        <!-- Kết quả tìm kiếm sẽ hiển thị tại đây -->
                    </tbody>
                </table>
            </div>
        </section>

        <section class="action-buttons">
            <button class="btn-back" onclick="window.location.href='index.html'">
                <i class="fas fa-long-arrow-alt-left"></i>
                Quay lại
            </button>
        </section>
    </main>

    <script>
        // Dữ liệu bệnh nhân giả lập
        const patients = [
            {
                id: "BN001",
                name: "Nguyễn Văn A",
                gender: "Nam",
                ethnicity: "Kinh",
                dob: "1990-01-01",
                address: "Hà Nội",
                phone: "0123456789",
                job: "Kỹ sư",
                note: "Không có"
            },
            {
                id: "BN002",
                name: "Trần Thị B",
                gender: "Nữ",
                ethnicity: "Tày",
                dob: "1995-05-15",
                address: "TP HCM",
                phone: "0987654321",
                job: "Giáo viên",
                note: "Không có"
            },
            {
                id: "BN003",
                name: "Trần Thị B",
                gender: "Nữ",
                ethnicity: "Tày",
                dob: "1995-05-15",
                address: "TP HCM",
                phone: "0987654321",
                job: "Giáo viên",
                note: "Không có"
            },
            {
                id: "BN004",
                name: "Trần Thị B",
                gender: "Nữ",
                ethnicity: "Tày",
                dob: "1995-05-15",
                address: "TP HCM",
                phone: "0987654321",
                job: "Giáo viên",
                note: "Không có"
            }
            // Thêm bệnh nhân tại đây
        ];
    
        // Hàm lấy giá trị từ các ô nhập liệu
        function getSearchCriteria() {
            return {
                patientId: document.getElementById("searchPatientId").value.trim(),
                fullName: document.getElementById("searchFullName").value.trim(),
                gender: document.getElementById("searchGender").value,
                ethnicity: document.getElementById("searchEthnicity").value.trim(),
                dob: document.getElementById("searchDob").value,
                address: document.getElementById("searchAddress").value.trim(),
                phone: document.getElementById("searchPhone").value.trim(),
                job: document.getElementById("searchJob").value.trim()
            };
        }
    
        // Hàm lọc bệnh nhân theo tiêu chí
        function filterPatients(criteria) {
            return patients.filter(patient => {
                return (
                    (!criteria.patientId || patient.id.includes(criteria.patientId)) &&
                    (!criteria.fullName || patient.name.toLowerCase().includes(criteria.fullName.toLowerCase())) &&
                    (!criteria.gender || patient.gender === criteria.gender) &&
                    (!criteria.ethnicity || patient.ethnicity.toLowerCase().includes(criteria.ethnicity.toLowerCase())) &&
                    (!criteria.dob || patient.dob === criteria.dob) &&
                    (!criteria.address || patient.address.toLowerCase().includes(criteria.address.toLowerCase())) &&
                    (!criteria.phone || patient.phone.includes(criteria.phone)) &&
                    (!criteria.job || patient.job.toLowerCase().includes(criteria.job.toLowerCase()))
                );
            });
        }
    
        // Hàm hiển thị kết quả trong bảng
        function displayResults(filteredPatients) {
            const resultTableBody = document.getElementById("resultTableBody");
            resultTableBody.innerHTML = ""; // Xóa kết quả cũ
    
            if (filteredPatients.length > 0) {
                filteredPatients.forEach((patient, index) => {
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${patient.id}</td>
                            <td>${patient.name}</td>
                            <td>${patient.gender}</td>
                            <td>${patient.ethnicity}</td>
                            <td>${patient.dob}</td>
                            <td>${patient.address}</td>
                            <td>${patient.phone}</td>
                            <td>${patient.job}</td>
                            <td>${patient.note}</td>
                        </tr>
                    `;
                    resultTableBody.innerHTML += row;
                });
            } else {
                resultTableBody.innerHTML = `<tr><td colspan="10" style="text-align: left;">Không tìm thấy bệnh nhân.</td></tr>`;
            }
        }
    
        // Xử lý khi nhấn nút tìm kiếm
        document.getElementById("searchButton").addEventListener("click", function () {
            const criteria = getSearchCriteria(); // Lấy tiêu chí tìm kiếm
            const filteredPatients = filterPatients(criteria); // Lọc danh sách bệnh nhân
            displayResults(filteredPatients); // Hiển thị kết quả
        });

        // Thêm sự kiện cho mỗi dòng của bảng để lắng nghe sự kiện nhấn đúp
        document.getElementById("resultTableBody").addEventListener("dblclick", function (event) {
            // Kiểm tra nếu người dùng nhấn đúp vào một dòng (trừ ô tiêu đề)
            const row = event.target.closest("tr");
            if (row) {
                const cells = row.querySelectorAll("td");
                // Lấy thông tin bệnh nhân từ các ô trong dòng
                const patient = {
                    id: cells[1].innerText,
                    name: cells[2].innerText,
                    gender: cells[3].innerText,
                    ethnicity: cells[4].innerText,
                    dob: cells[5].innerText,
                    address: cells[6].innerText,
                    phone: cells[7].innerText,
                    job: cells[8].innerText,
                    note: cells[9].innerText
                };

                // Lưu thông tin bệnh nhân vào localStorage để chuyển sang trang khác
                localStorage.setItem("patientData", JSON.stringify(patient));

                // Chuyển hướng đến trang nhận bệnh
                window.location.href = "./index.html"; // Địa chỉ của trang nhận bệnh
            }
        });
    </script>        
</body>
</html>
